# 数据库 Project01 项目要求

## 基本要求

报告 $8 - 20$ 页，不鼓励卷报告页数。

项目主要目的：

- 找到给出数据的内在关系，并设计出ER图。
- 使用 $PostgreSQL$ 数据库设计关系型数据库。
- 将所有数据导入到数据库中。
- 比较数据库和 $Java$ 中的文件输入输出在检索和修改数据的表现。

## 背景

### 管理目标

#### 管理对象

公司、快递员、船只、集装箱。

#### 对象特点

- 公司的数目不是很多，快递员比较多。

- 一个快递员只能服务一个公司。

- 船只能作为设备登记在公司名下。

- 集装箱不属于任何公司，只在船上使用，将货物打包成相同的大小，运送过程中不考虑损失。

### 数据描述

共有 $500000$ 条数据，每一列都表示一个信息。

1. `Item Name` 项目名称（Unique）。
2. `Item Class` 项目种类名称。
3. `Item Price` 项目价格。
4. `Item Retrieval City` 检索城市。
5. `Retrieval Start Time` 检索时间。
6. `Retrieval Courier` 检索快递员名称。
7. `Retrieval Courier Gender` 检索快递员性别。
8. `Retrieval Courier Age` 检索快递员年龄。
9. `Retrieval Courier Phone Number` 检索快递员手机号码。
10. `Delivery Finished Time` 结束时间，当寄送未完成时为EMPTY。
11. `Delivery City` 结束城市。
12. `Delivery Courier` 寄送快递员名称，当寄送未完成时为EMPTY。
13. `Delivery  Courier  Gender` 寄送快递员性别。
14. `Delivery Courier Age` 寄送快递员年龄。
15. `Delivery Courier Phone Number` 寄送快递员手机号码。
16. `Item Export City` 项目出口城市。
17. `Item Import City` 项目进口城市。
18. `Item Export Tax` 项目出口税。
19. `Item Import Tax` 项目进口税。
20. `Item Export Time` 项目出口时间，可为EMPTY。
21. `Item Import Time` 项目进口时间，可为EMPTY。
22. `Container Code` 集装箱编号（Unique），当进口时间为EMPTY时为EMPTY。
23. `Container Type` 集装箱类型，当进口时间为EMPTY时为EMPTY。
24. `Ship Name` 船只名称（Unique），当出口时间为EMPTY时为EMPTY。
25. `Company Name` 管理装运船只、检索快递员、寄送快递员的公司名称（独特）。
26. `Log Time` 上次更新时间。

### 注意事项

- 一个寄送项目的完整路径是：检索城市 - 出口城市 - 打包装船 - 进口城市 - 目标城市
- 一些列可能是空值，信息是关联的，它们之间也有关系，不可忽略。
- 假设一个快递员只在一个城市工作。

## 要求

### 基本信息

1. 姓名、学号、lab课号。
2. 组内各成员的贡献，请清晰的表明什么部分是谁做的。

### E-R 图（15%）

使用绘图软件绘制 E-R 图，不能手写，请遵循 E - R图的绘制要求。

使用截图或者绘图软件的矢量图形都可。

请指出绘制图表所用工具的名称。

### 数据库设计 (25%)

#### 基本要求 (25 / 25)

1. 根据背景设计表和列。
2. 通过 `DataGrip` 的 "显示可视化" 生成数据库图标，截图或者矢量图形。
3. 简要描述表和列的含义，包括但不限于表和列的含义。
4. （同时提交SQL附件，但不写入报告）其中包含创建所有表的创建表语句DDL。

#### 注意事项

1. 所有数据在`shipment_records.csv` 中。
2. 你的设计应该满足第1范式，第2范式和第3范式。
3. 使用主键和外键表示数据的重要属性和关系。
4. 每个表中的不同行应该有互相区别的主键（可以是简单主键也可以是复合主键）。
5. 每个表都应该包括至少一个外键，孤立的表是不被允许的。
6. 表之间的外键不能成环。
7. 每一个表都应该有一个非空列（包括主键列，但不包括ID列）
8. 除了系统自动生成的自增量ID列之外，至少有一列满足唯一性约束。
9. 为不同字段设置合适的数据类型。
10. 需求发生变化时，设计应该容易拓展。

### 数据导入 (25%)

写一个脚本，从原始数据集`shipment_records.csv` 导入数据到上面设计的数据表中。在导入完所有数据后，请确认所有数据都成功导入了。

#### 基本需求 (15 / 25)

1. 写一个导入数据的脚本。
2. 在报告中指出脚本时如何工作的，包括但不限于如何正确运行、导入数据、必要的先决条件、运行时的注意事项。

#### 高级需求 (10 / 25)

1. 找到大于 $1$ 种导入数据的方法，并且比较分析这些方法的计算效率。
2. 尝试优化脚本，描述如何优化，并分析与原始版本相比效率提高多少。

#### 注意事项

对于高级任务，请确保描述您的测试环境、过程和实际时间成本，请在报告中分析实验结果。

### 比较数据库管理系统和Java的输入输出 (35%)

在这个任务中，你被要求比较数据库和文件读写对数据检索和操纵的效率，请按如下步骤比较分析：

1. 使用数据库应用程序接口（API）：根据你创建的数据库，你需要写一个Java程序，通过数据库接口执行一系列的`INSERT` `DELETE` `UPDATE` `SELECT` 操作，您可以自行决定每种类型中的语句数，并决定修改和读取哪些数据。但是每种操作的数目不能太小，因为这样不能说明数据库API相对于文件IO的优势和劣势（更具编程语言的不同，通常每个记录数万条就足够了）。最后，你需要记录每个语句类型或每个语句的运行时间，这里我们在数据库中提供了一些典型的测试描述：
   - `INSERT` 首先，随机删除csv文件中的一些行并导入数据库。然后评估岛屿csv文件其他行的时间成本。
   - `DELETE` 首先，将csv文件的所有数据导入到数据库中，然后评估删除数据中任意选择的行的时间成本。
   - `UPDATE` 首先，将csv文件的所有数据导入到数据库中，然后评估将所用空值替换为任意值的时间成本。
   - `SELECT` 首先，将csv文件的所有数据倒数数据库，然后评估找到那些未完成的记录或者找到被随机容器包装的时间成本。你可能会更加关注`SELECT` 语句，因为它在许多实际场景中比其他测试使用的更加频繁。
2. 使用文件应用程序接口（API）：这一步操作旨在通过编程语言Java的标准文件API复制第一步中的所有操作。首先创建与数据库管理系统表中相同数据的文件，然后编写一个程序，像在SQL语句和查询中那样插入、删除、更新和查找数据项。确保文件操作（和操作数）与 SQL操作（和语句数）。最后，按照数据库API基准测试记录的每个操作（类型）的运行时间。
3. 比较分析：分别比较数据库管理系统和文件中的相同操作/语句的记录运行时间。您可以从多个级别进行比较，例如将语句与相应的操作进行比较（语句级别），或者将特定类型中的所有语句的总时间与相应运算类型进行比较（类型级别）

#### 基本要求 (20 / 35)

1. 测试环境的描述，包括（但不限于）：硬件规格（CPU型号、内存大小、是否使用固态硬盘（SSD）或者硬盘驱动器（HDD）、磁盘的速度（顺序还是随机））软件规范（DBMS和操作系统的版本、选择的编程语言和开发环境（语言版本、编译器和库的特定版本等））。在报告环境时，请思考这个问题：如果他人要复制你的实验，应该向他提供哪些必要信息。
2. 说明如何在DBMS和数据文件中组织测试数据，包括如何生成测试SQL语句以及文件的数据格式/结构。
3. 描述测试SQL脚本和源程序。（不要在报告中复制和粘贴整个脚本和程序，相反将源码作为附件提交）。
4. 对应语句和操作的运行时间的比较研究。我们鼓励您使用数据可视化来展示结果。确保图形、表格等使用一致的格式。除了运行时间的列表和图标外，还要求您描述运行性能的主要差异、您在结果中发现的有趣之处、您在实验中可能向其他人展示的见解等。

这里用一些关于更好地完成这次实验的提示：

- 使用不同数量级的语句/操作执行上述基准测试。
- 选择或设计要在文件中存储数据的任何格式，例如纯文本（CSV\JSON\XML）或者自定义二进制格式。
- 请使用标准文件API，即`Java.io` 。唯一的例外是，如果你选择使用JSON和XML，如果标准库没有提供，你可能会使用到第三方JSON/XML库，例如Gson。
- 我们承认，有许多库可以促进数据操作工作，甚至可以显著提高插入和选择的性能（例如 Python中的Pandas ）。建议您也将这些库的性能与DBMS进行比较。但是，您应该事先对DBMS与标准文件API进行分析。
- 一些有用的资源分析：
  - [Advantages of Database Management System over File System](https://www.csestack.org/advantages-of-database-management-system-over-file-system/)
  - [Advantages of Database Management System](https://www.tutorialspoint.com/Advantages-of-Database-Management-System)
  - [Chapter 3 Characteristics and Benefits of a Database](https://opentextbc.ca/dbdesign01/chapter/chapter-3-characteristics-and-benefits-of-a-database/)

#### 高级需求 (15 / 35)

除了基本要求之外，您还可以考虑以下一些高级任务（但不限于以下任务），以挑战自己并获得剩余分数。

1. 如果希望确定哪些集装箱已经服务（集装箱在船上的时间）了多年（由类型决定），以通知港口进行维护，您的数据库可以处理此类问题吗？你的文件 I/O 程序可以吗？如果可以的话，哪一个表现会更好。如果不能的话，为什么。
2. 你能确定在你的数据库中为每个城市的每家公司搜集/发送最多货物的检索和递送快递员吗？你的文件I/O程序可以吗？如果是的话，哪一个表现会更好？如果没有，为什么。
3. 如果一家公司将出口不同类型的物品（例如，物品类别栏中不同值得一半）。那么应该分别选择哪些城市来达到最低出口成本？你的数据库能处理这样得问题吗？你的文件I/O程序怎么样？如果是得话，哪一个表现会更好？
4. 您的数据可以处理高并发性吗？您可以尝试更高的数量级执行上述基准，例如数十万个选择。
5. 您能否将性能与不同的数据软件（例如MySQL、MariaDB、SQLite）、文件系统、磁盘性能和类型、编程语言、库或操作系统进行比较。

## 如何提交

提交PDF报告并附上必要的附件（如SQL脚本和源代码文件）在Saikai站点。

`DDL` 是 `10 月 30 日 晚上 23：00`

对于附件，请更具它们放在单独的目录中，并将它们压缩到zip存档中。

